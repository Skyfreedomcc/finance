<script setup>
import { useRouter } from 'vue-router'
import {
  Menu as IconMenu, PieChart, Setting,
  Avatar, Box, Van, Wallet, DocumentChecked, Reading,
  CreditCard
} from '@element-plus/icons-vue'

const router = useRouter()
const handleLogout = () => {
  localStorage.removeItem('user')
  router.push('/login')
}
</script>

<template>
  <div class="common-layout">
    <el-container>
      <el-aside width="220px" class="aside-menu">

        <div class="logo-box"><h2>ğŸ’° ä¼ä¸šè´¢åŠ¡é€š</h2></div>

        <el-menu
          class="custom-menu"
          :default-active="$route.path"
          router
          background-color="#001529"
          text-color="#a6adb4"
          active-text-color="#409EFF"
        >

          <el-menu-item index="/dashboard">
            <el-icon><IconMenu /></el-icon><span>å·¥ä½œå°</span>
          </el-menu-item>

          <el-sub-menu index="1">
            <template #title><el-icon><Wallet /></el-icon><span>èµ„é‡‘è´¦åŠ¡</span></template>
            <el-menu-item index="/voucher/list">
              <el-icon><Reading /></el-icon><span>å‡­è¯åºæ—¶ç°¿ (æµæ°´)</span>
            </el-menu-item>
            <el-menu-item index="/ledger/subject">
              <el-icon><Wallet /></el-icon><span>ç§‘ç›®ä½™é¢è¡¨ (æ€»è´¦)</span>
            </el-menu-item>
            <el-menu-item index="/voucher/posting">
              <el-icon><DocumentChecked /></el-icon><span>è¿‡è´¦å®¡æ ¸ä¸­å¿ƒ</span>
            </el-menu-item>
            <el-menu-item index="/payment/center">
              <el-icon><CreditCard /></el-icon><span>æ”¶ä»˜æ¬¾ä¸­å¿ƒ</span>
            </el-menu-item>
          </el-sub-menu>

          <el-sub-menu index="2">
            <template #title><el-icon><Van /></el-icon><span>ä¾›åº”å•† (é‡‡è´­)</span></template>
            <el-menu-item index="/vendor/list">ä¾›åº”å•†åˆ—è¡¨</el-menu-item>
            <el-menu-item index="/invoice/purchase">æ–°å»ºé‡‡è´­è´¦å•</el-menu-item>
          </el-sub-menu>

          <el-sub-menu index="3">
            <template #title><el-icon><Box /></el-icon><span>å®¢æˆ· (é”€å”®)</span></template>
            <el-menu-item index="/customer/list">å®¢æˆ·åˆ—è¡¨</el-menu-item>
            <el-menu-item index="/invoice/sale">æ–°å»ºé”€å”®å‘ç¥¨</el-menu-item>
          </el-sub-menu>

          <el-sub-menu index="4">
            <template #title><el-icon><Avatar /></el-icon><span>å‘˜å·¥ç®¡ç†</span></template>
            <el-menu-item index="/employee/list">å‘˜å·¥èŠ±åå†Œ</el-menu-item>
            <el-menu-item index="/salary/payroll">å·¥èµ„å‘æ”¾</el-menu-item>
          </el-sub-menu>

          <el-menu-item index="/report/analysis">
            <el-icon><PieChart /></el-icon><span>è´¢åŠ¡æŠ¥è¡¨ä¸­å¿ƒ</span>
          </el-menu-item>

          <el-sub-menu index="6">
            <template #title><el-icon><Setting /></el-icon><span>åŸºç¡€è®¾ç½®</span></template>
            <el-menu-item index="/account/list">ä¼šè®¡ç§‘ç›®è¡¨</el-menu-item>
            <el-menu-item index="/user/list">ç”¨æˆ·æƒé™</el-menu-item>
          </el-sub-menu>
        </el-menu>
      </el-aside>

      <el-container>
        <el-header class="header-bar">
          <div>å½“å‰è´¦å¥—ï¼š2025å¹´ä¸»è´¦ç°¿ (é»˜è®¤)</div>
          <el-button type="danger" link @click="handleLogout">é€€å‡º</el-button>
        </el-header>
        <el-main class="main-content"><RouterView /></el-main>
      </el-container>
    </el-container>
  </div>
</template>

<style scoped>
/* ç¡®ä¿æœ€å¤–å±‚å®¹å™¨å æ»¡å…¨å± */
.common-layout, .el-container {
  height: 100vh;
  overflow: hidden; /* é˜²æ­¢å‡ºç°åŒé‡æ»šåŠ¨æ¡ */
}

/* ä¾§è¾¹æ æ•´ä½“æ ·å¼ */
.aside-menu {
  background-color: #001529;
  /* ç¦æ­¢ä¾§è¾¹æ æœ¬èº«æ»šåŠ¨ */
  overflow: hidden !important;
  height: 100vh;
  position: relative;
  /* å¦‚æœä½ çš„ Element Plus ç‰ˆæœ¬å¯¼è‡´å®½åº¦ä¸å¯¹ï¼Œå¯ä»¥å°è¯•å¼ºåˆ¶ flex-shrink */
  flex-shrink: 0;
}

/* Logo åŒºåŸŸï¼šå›ºå®šé«˜åº¦ */
.logo-box {
  height: 60px;
  line-height: 60px;
  text-align: center;
  color: white;
  background: #002140;
  width: 100%;
  position: absolute; /* ç»å¯¹å®šä½åœ¨é¡¶éƒ¨ */
  top: 0;
  left: 0;
  z-index: 100; /* ç¡®ä¿åœ¨èœå•ä¹‹ä¸Š */
}

/* èœå•åŒºåŸŸï¼šå…³é”®ä¿®æ”¹ */
.custom-menu {
  /* 1. å¼ºè¡Œè®¾ç½®é«˜åº¦ = å±å¹•é«˜åº¦(100vh) - Logoé«˜åº¦(60px)
     2. åŠ ä¸Š margin-top: 60px ç»™ Logo è®©å‡ºä½ç½®
  */
  height: calc(100vh - 60px) !important;
  margin-top: 60px;

  /* å¼€å¯å‚ç›´æ»šåŠ¨ */
  overflow-y: auto !important;

  /* å»æ‰è¾¹æ¡† */
  border-right: none;

  /* ç¡®ä¿å®½åº¦å æ»¡ */
  width: 100%;
}

/* æ»šåŠ¨æ¡æ ·å¼ç¾åŒ– */
.custom-menu::-webkit-scrollbar {
  width: 6px;
}
.custom-menu::-webkit-scrollbar-thumb {
  background: #3c495e;
  border-radius: 3px;
}
.custom-menu::-webkit-scrollbar-track {
  background: #001529;
}

.header-bar {
  background: #fff;
  border-bottom: 1px solid #ddd;
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 0 20px;
}

.main-content {
  background: #f0f2f5;
  padding: 20px;
  overflow-y: auto;
}
</style>